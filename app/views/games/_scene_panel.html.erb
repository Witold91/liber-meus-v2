<style>
  .scene-panel { border: 1px solid #2a2318; background: #0f0d09; font-size: 0.8rem; }
  .scene-panel-header { padding: 0.55rem 1rem; border-bottom: 1px solid #2a2318; display: flex; justify-content: space-between; align-items: center; background: #0c0a07; }
  .scene-panel-header h3 { font-family: 'Cinzel', 'Palatino Linotype', serif; font-size: 0.72rem; font-weight: 400; letter-spacing: 0.12em; color: var(--theme-accent); }
  .scene-toggle-btn { background: transparent; border: 1px solid #2a2318; color: #4a4030; padding: 0.18rem 0.45rem; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.58rem; letter-spacing: 0.1em; }
  .scene-toggle-btn:hover { color: #6a6050; border-color: #3a3020; }
  .scene-panel-body { padding: 0.75rem 1rem; }
  .scene-description { font-family: 'Lora', Georgia, serif; font-style: italic; color: #5a5040; font-size: 0.78rem; line-height: 1.5; margin-bottom: 0.75rem; border-bottom: 1px solid #1e1810; padding-bottom: 0.5rem; }
  .scene-section-label { font-family: 'Cinzel', serif; color: #3a3020; font-size: 0.58rem; text-transform: uppercase; letter-spacing: 0.2em; margin: 0.6rem 0 0.2rem; }
  .actor-item, .object-item, .exit-item { padding: 0.22rem 0; color: #7a6a58; }
  .actor-name, .object-name { color: #b0a890; }
  .status-badge { display: inline-block; background: #1a1610; border: 1px solid #2e2418; color: #5a5040; padding: 0 0.3rem; font-size: 0.65rem; margin-left: 0.3rem; font-family: 'Cinzel', serif; letter-spacing: 0.08em; }
  .exit-label { color: #6a8a78; }
  .exit-arena { color: #b8a850; }
  .scene-empty { font-family: 'Lora', Georgia, serif; font-style: italic; color: #3a3020; }
  /* Actor description tooltip */
  .actor-item { position: relative; }
  .actor-item[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    left: 0;
    top: 100%;
    z-index: 10;
    background: #100e0a;
    border: 1px solid #2a2318;
    color: #8a7a68;
    font-family: 'Lora', Georgia, serif;
    font-style: italic;
    font-size: 0.72rem;
    line-height: 1.5;
    padding: 0.35rem 0.5rem;
    white-space: normal;
    width: 220px;
    pointer-events: none;
  }
</style>

<div class="scene-panel"
     data-controller="scene-panel"
     data-scene-panel-hide-label-value="<%= t('views.scene_panel.hide') %>"
     data-scene-panel-show-label-value="<%= t('views.scene_panel.show') %>"
     id="scene-panel">
  <div class="scene-panel-header">
    <h3 id="scene-panel-title"><%= scene_context&.dig(:scene, :name) || t("views.scene_panel.unknown_location") %></h3>
    <button class="scene-toggle-btn" data-action="click->scene-panel#toggle" data-scene-panel-target="toggleBtn">
      <%= t("views.scene_panel.hide") %>
    </button>
  </div>

  <div class="scene-panel-body" data-scene-panel-target="body">
    <% if scene_context %>
      <div class="scene-description"><%= scene_context.dig(:scene, :description) %></div>

      <% if scene_context[:actors].any? %>
        <div class="scene-section-label"><%= t("views.scene_panel.actors") %></div>
        <% scene_context[:actors].each do |actor| %>
          <div class="actor-item"<% if actor[:description].present? %> data-tooltip="<%= actor[:description] %>"<% end %>>
            <span class="actor-name"><%= actor[:name] %></span>
            <% actor[:statuses].each do |status| %>
              <span class="status-badge"><%= t("game.status_values.#{status}", default: status) %></span>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <% if scene_context[:objects].any? %>
        <div class="scene-section-label"><%= t("views.scene_panel.objects") %></div>
        <% scene_context[:objects].each do |obj| %>
          <div class="object-item">
            <span class="object-name"><%= obj[:name] %></span>
            <% obj[:statuses].each do |status| %>
              <span class="status-badge"><%= t("game.status_values.#{status}", default: status) %></span>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <% if scene_context[:exits].any? %>
        <div class="scene-section-label"><%= t("views.scene_panel.exits") %></div>
        <% scene_context[:exits].each do |exit_def| %>
          <div class="exit-item">
            <span class="<%= exit_def['arena_exit'] ? 'exit-arena' : 'exit-label' %>">
              → <%= exit_def['label'] %><%= " ★" if exit_def['arena_exit'] %>
            </span>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <div class="scene-empty"><%= t("views.scene_panel.empty") %></div>
    <% end %>
  </div>
</div>
