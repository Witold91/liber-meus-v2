<style>
  .turn-entry { border-left: 2px solid #2a2318; padding-left: 0.75rem; }
  .turn-entry.prologue { border-left-color: var(--theme-accent); }
  .turn-entry.success { border-left-color: #507a60; }
  .turn-entry.partial { border-left-color: #907830; }
  .turn-entry.failure { border-left-color: #903030; }
  .turn-entry.ending { border-left-color: #8a7a40; background: linear-gradient(180deg, rgba(138, 122, 64, 0.12), transparent); padding: 0.8rem 0.75rem; border-radius: 2px; }
  .turn-entry.ending.completed { border-left-color: var(--theme-accent); background: linear-gradient(180deg, color-mix(in srgb, var(--theme-accent) 12%, transparent), transparent); }
  .turn-entry.ending.failed { border-left-color: #903030; background: linear-gradient(180deg, rgba(144, 48, 48, 0.12), transparent); }
  .turn-ending-label { font-family: 'Cinzel', serif; font-size: 0.6rem; letter-spacing: 0.3em; color: #c8b860; text-transform: uppercase; margin-bottom: 0.6rem; }
  .turn-entry.ending.completed .turn-ending-label { color: var(--theme-accent); }
  .turn-entry.ending.failed .turn-ending-label { color: #c87878; }
  .turn-action { font-family: 'Lora', Georgia, serif; font-style: italic; color: #5a5040; font-size: 0.84rem; margin-bottom: 0.45rem; }
  .turn-narrative { font-family: var(--theme-font); color: var(--theme-text); line-height: 1.7; font-size: 0.92rem; white-space: pre-wrap; }
  .turn-meta { font-family: 'Cinzel', serif; font-size: 0.58rem; letter-spacing: 0.2em; color: #3a3020; margin-top: 0.4rem; text-transform: uppercase; }
  .act-header { font-family: 'Cinzel', serif; font-size: 0.65rem; letter-spacing: 0.3em; color: var(--theme-accent); text-transform: uppercase; text-align: center; margin-bottom: 0.6rem; opacity: 0.8; }
</style>

<%
  entry_class =
    if turn.options_payload["ending"]
      "ending #{turn.options_payload["ending_status"]}"
    elsif turn.options_payload["prologue"]
      "prologue"
    else
      turn.resolution_tag
    end
%>
<div class="turn-entry <%= entry_class %>"
     id="turn-<%= turn.id %>">
  <% if turn.options_payload["ending"] %>
    <div class="turn-ending-label"><%= t("views.games.ending_label") %></div>
  <% end %>
  <% if (act_num = turn.options_payload["act_number"]) %>
    <div class="act-header">— <%= t("views.games.act_header", number: act_num) %> —</div>
  <% end %>
  <% if turn.option_selected.present? %>
    <div class="turn-action">&gt; <%= turn.option_selected %></div>
  <% end %>
  <div class="turn-narrative"><%= turn.content %></div>
  <% if turn.resolution_tag.present? %>
    <div class="turn-meta">[<%= t("game.resolution_tags.#{turn.resolution_tag}", default: turn.resolution_tag) %>]</div>
  <% end %>
</div>
